# Generated by Django 5.2.7 on 2025-11-08 13:25

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('contenttypes', '0002_remove_content_type_name'),
        ('core', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ClauseLibrary',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('clause_code', models.CharField(db_index=True, help_text='Unique clause code (e.g., PAY-NET30)', max_length=50, unique=True)),
                ('clause_title', models.CharField(max_length=200)),
                ('clause_category', models.CharField(choices=[('GENERAL', 'General Terms'), ('PAYMENT', 'Payment Terms'), ('DELIVERY', 'Delivery Terms'), ('WARRANTY', 'Warranty'), ('LIABILITY', 'Liability & Indemnity'), ('CONFIDENTIALITY', 'Confidentiality'), ('TERMINATION', 'Termination'), ('DISPUTE', 'Dispute Resolution'), ('COMPLIANCE', 'Compliance & Regulatory'), ('SLA', 'Service Level Agreement'), ('IP', 'Intellectual Property'), ('DATA_PROTECTION', 'Data Protection'), ('FORCE_MAJEURE', 'Force Majeure'), ('OTHER', 'Other')], db_index=True, max_length=30)),
                ('clause_text', models.TextField(help_text='Standard clause text with placeholders')),
                ('placeholders', models.JSONField(blank=True, default=list, help_text='List of placeholders in clause text (e.g., {{SUPPLIER_NAME}})')),
                ('description', models.TextField(blank=True, help_text='When and how to use this clause')),
                ('notes', models.TextField(blank=True)),
                ('version', models.CharField(default='1.0', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_clauses', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_clauses', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Clause Library',
                'verbose_name_plural': 'Clause Libraries',
                'ordering': ['clause_category', 'clause_code'],
            },
        ),
        migrations.CreateModel(
            name='Contract',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contract_number', models.CharField(db_index=True, max_length=50, unique=True)),
                ('contract_title', models.CharField(max_length=200)),
                ('contract_type', models.CharField(choices=[('PURCHASE', 'Purchase Contract'), ('SALES', 'Sales Contract'), ('SERVICE', 'Service Contract'), ('MASTER', 'Master Agreement'), ('FRAMEWORK', 'Framework Agreement'), ('NDA', 'Non-Disclosure Agreement'), ('SLA', 'Service Level Agreement'), ('LICENSE', 'License Agreement'), ('OTHER', 'Other')], db_index=True, max_length=20)),
                ('party_object_id', models.PositiveIntegerField()),
                ('contract_date', models.DateField(help_text='Contract signature date')),
                ('effective_date', models.DateField(help_text='When contract becomes effective')),
                ('expiry_date', models.DateField(help_text='Contract expiration date')),
                ('total_value', models.DecimalField(decimal_places=2, help_text='Total contract value', max_digits=15)),
                ('annual_value', models.DecimalField(decimal_places=2, default=0, help_text='Annual contract value', max_digits=15)),
                ('term_months', models.IntegerField(help_text='Contract term in months')),
                ('auto_renewal', models.BooleanField(default=False, help_text='Auto-renew on expiry')),
                ('renewal_notice_days', models.IntegerField(default=90, help_text='Days notice required for renewal/termination')),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('UNDER_REVIEW', 'Under Review'), ('PENDING_APPROVAL', 'Pending Approval'), ('APPROVED', 'Approved'), ('ACTIVE', 'Active'), ('EXPIRING_SOON', 'Expiring Soon'), ('EXPIRED', 'Expired'), ('TERMINATED', 'Terminated'), ('RENEWED', 'Renewed'), ('CANCELLED', 'Cancelled')], db_index=True, default='DRAFT', max_length=20)),
                ('is_renewable', models.BooleanField(default=True)),
                ('is_terminated', models.BooleanField(default=False)),
                ('termination_date', models.DateField(blank=True, null=True)),
                ('termination_reason', models.TextField(blank=True)),
                ('approval_status', models.CharField(choices=[('PENDING', 'Pending'), ('APPROVED', 'Approved'), ('REJECTED', 'Rejected')], default='PENDING', max_length=20)),
                ('approved_date', models.DateTimeField(blank=True, null=True)),
                ('original_document', models.FileField(blank=True, help_text='Original signed contract document', null=True, upload_to='contracts/')),
                ('reminder_sent', models.BooleanField(default=False)),
                ('reminder_sent_date', models.DateField(blank=True, null=True)),
                ('description', models.TextField(blank=True)),
                ('internal_notes', models.TextField(blank=True, help_text='Internal notes (use ContractNote for audit trail)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_contracts', to=settings.AUTH_USER_MODEL)),
                ('contract_owner', models.ForeignKey(help_text='Internal contract owner/manager', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='owned_contracts', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_contracts', to=settings.AUTH_USER_MODEL)),
                ('currency', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='core.currency')),
                ('legal_reviewer', models.ForeignKey(blank=True, help_text='Legal team reviewer', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reviewed_contracts', to=settings.AUTH_USER_MODEL)),
                ('party_content_type', models.ForeignKey(limit_choices_to={'model__in': ['supplier', 'customer']}, on_delete=django.db.models.deletion.PROTECT, to='contenttypes.contenttype')),
                ('renewed_from', models.ForeignKey(blank=True, help_text='Previous contract if this is a renewal', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='renewals', to='contracts.contract')),
                ('terminated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='terminated_contracts', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='updated_contracts', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contract',
                'verbose_name_plural': 'Contracts',
                'ordering': ['-contract_date', '-contract_number'],
            },
        ),
        migrations.CreateModel(
            name='ContractAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document_type', models.CharField(choices=[('CONTRACT', 'Main Contract Document'), ('AMENDMENT', 'Amendment'), ('EXHIBIT', 'Exhibit/Appendix'), ('CORRESPONDENCE', 'Correspondence'), ('INVOICE', 'Invoice'), ('REPORT', 'Report'), ('CERTIFICATE', 'Certificate'), ('OTHER', 'Other')], max_length=30)),
                ('document_name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('file', models.FileField(upload_to='contract_attachments/')),
                ('file_size', models.IntegerField(help_text='File size in bytes')),
                ('file_type', models.CharField(help_text='MIME type', max_length=50)),
                ('version', models.CharField(default='1.0', max_length=20)),
                ('is_latest', models.BooleanField(default=True)),
                ('document_date', models.DateField(blank=True, null=True)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='contracts.contract')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='uploaded_contract_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contract Attachment',
                'verbose_name_plural': 'Contract Attachments',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='ContractClause',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('clause_number', models.CharField(help_text='Clause numbering (e.g., 3.2.1)', max_length=20)),
                ('clause_title', models.CharField(max_length=200)),
                ('clause_text', models.TextField(help_text='Actual clause text in contract')),
                ('is_critical', models.BooleanField(default=False, help_text='Critical clause requiring special attention')),
                ('is_negotiable', models.BooleanField(default=True, help_text='Whether clause is negotiable')),
                ('notes', models.TextField(blank=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='clauses', to='contracts.contract')),
                ('library_clause', models.ForeignKey(blank=True, help_text='Reference to standard clause', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_clauses', to='contracts.clauselibrary')),
            ],
            options={
                'verbose_name': 'Contract Clause',
                'verbose_name_plural': 'Contract Clauses',
                'ordering': ['clause_number'],
            },
        ),
        migrations.CreateModel(
            name='ContractNote',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('note_type', models.CharField(choices=[('GENERAL', 'General Note'), ('NEGOTIATION', 'Negotiation Note'), ('AMENDMENT', 'Amendment Note'), ('REVIEW', 'Review Comment'), ('COMPLIANCE', 'Compliance Note'), ('RENEWAL', 'Renewal Note')], default='GENERAL', max_length=30)),
                ('note_text', models.TextField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notes', to='contracts.contract')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Contract Note',
                'verbose_name_plural': 'Contract Notes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ContractPenalty',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('penalty_type', models.CharField(choices=[('PENALTY', 'Penalty'), ('LIQUIDATED_DAMAGES', 'Liquidated Damages'), ('INCENTIVE', 'Incentive/Bonus'), ('DISCOUNT', 'Discount')], max_length=30)),
                ('trigger_type', models.CharField(choices=[('SLA_BREACH', 'SLA Breach'), ('LATE_DELIVERY', 'Late Delivery'), ('QUALITY_ISSUE', 'Quality Issue'), ('EARLY_DELIVERY', 'Early Delivery (Incentive)'), ('PERFORMANCE_BONUS', 'Performance Bonus'), ('OTHER', 'Other')], max_length=30)),
                ('description', models.TextField()),
                ('calculation_method', models.CharField(help_text='How penalty is calculated', max_length=200)),
                ('penalty_amount', models.DecimalField(decimal_places=2, default=0, help_text='Fixed penalty amount (if applicable)', max_digits=15)),
                ('penalty_percentage', models.DecimalField(decimal_places=2, default=0, help_text='Percentage of contract value (if applicable)', max_digits=5)),
                ('max_penalty_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum total penalty', max_digits=15, null=True)),
                ('max_penalty_percentage', models.DecimalField(blank=True, decimal_places=2, help_text='Max penalty as % of contract value', max_digits=5, null=True)),
                ('total_penalties_applied', models.DecimalField(decimal_places=2, default=0, max_digits=15)),
                ('penalty_count', models.IntegerField(default=0)),
                ('is_active', models.BooleanField(default=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='penalties', to='contracts.contract')),
            ],
            options={
                'verbose_name': 'Contract Penalty',
                'verbose_name_plural': 'Contract Penalties',
                'ordering': ['contract', 'penalty_type'],
            },
        ),
        migrations.CreateModel(
            name='ContractPenaltyInstance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('applied_date', models.DateField()),
                ('penalty_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('notes', models.TextField(blank=True)),
                ('invoice_reference', models.CharField(blank=True, max_length=100)),
                ('is_applied_to_invoice', models.BooleanField(default=False)),
                ('penalty', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='instances', to='contracts.contractpenalty')),
            ],
            options={
                'verbose_name': 'Penalty Instance',
                'verbose_name_plural': 'Penalty Instances',
                'ordering': ['-applied_date'],
            },
        ),
        migrations.CreateModel(
            name='ContractRenewal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('renewal_date', models.DateField(help_text='Date renewal was initiated')),
                ('proposed_expiry_date', models.DateField(help_text='Proposed new expiry date')),
                ('proposed_value', models.DecimalField(decimal_places=2, help_text='Proposed contract value', max_digits=15)),
                ('status', models.CharField(choices=[('PENDING', 'Pending Review'), ('UNDER_NEGOTIATION', 'Under Negotiation'), ('APPROVED', 'Approved for Renewal'), ('RENEWED', 'Renewed'), ('NOT_RENEWED', 'Not Renewed'), ('CANCELLED', 'Cancelled')], default='PENDING', max_length=30)),
                ('decision_date', models.DateField(blank=True, null=True)),
                ('decision_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='renewal_records', to='contracts.contract')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_renewals', to=settings.AUTH_USER_MODEL)),
                ('decision_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='contract_renewal_decisions', to=settings.AUTH_USER_MODEL)),
                ('renewed_contract', models.ForeignKey(blank=True, help_text='New contract created from renewal', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='renewal_source', to='contracts.contract')),
            ],
            options={
                'verbose_name': 'Contract Renewal',
                'verbose_name_plural': 'Contract Renewals',
                'ordering': ['-renewal_date'],
            },
        ),
        migrations.CreateModel(
            name='ContractSLA',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sla_name', models.CharField(max_length=200)),
                ('measurement_type', models.CharField(choices=[('UPTIME', 'Uptime %'), ('RESPONSE_TIME', 'Response Time'), ('RESOLUTION_TIME', 'Resolution Time'), ('AVAILABILITY', 'Availability %'), ('PERFORMANCE', 'Performance Score'), ('QUALITY', 'Quality Score'), ('DELIVERY', 'Delivery Time'), ('CUSTOM', 'Custom Metric')], max_length=30)),
                ('description', models.TextField()),
                ('target_value', models.DecimalField(decimal_places=2, help_text='Target value/percentage', max_digits=10)),
                ('minimum_value', models.DecimalField(decimal_places=2, help_text='Minimum acceptable value', max_digits=10)),
                ('measurement_unit', models.CharField(help_text='Unit of measurement (%, seconds, hours, etc.)', max_length=50)),
                ('measurement_frequency', models.CharField(choices=[('DAILY', 'Daily'), ('WEEKLY', 'Weekly'), ('MONTHLY', 'Monthly'), ('QUARTERLY', 'Quarterly'), ('ANNUAL', 'Annual')], max_length=20)),
                ('current_value', models.DecimalField(decimal_places=2, default=0, help_text='Current performance value', max_digits=10)),
                ('last_measured_date', models.DateField(blank=True, null=True)),
                ('is_compliant', models.BooleanField(default=True)),
                ('breach_count', models.IntegerField(default=0, help_text='Number of SLA breaches')),
                ('has_penalty', models.BooleanField(default=False)),
                ('penalty_description', models.TextField(blank=True)),
                ('is_active', models.BooleanField(default=True)),
                ('contract', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='slas', to='contracts.contract')),
            ],
            options={
                'verbose_name': 'Contract SLA',
                'verbose_name_plural': 'Contract SLAs',
                'ordering': ['contract', 'sla_name'],
            },
        ),
        migrations.AddField(
            model_name='contractpenalty',
            name='related_sla',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='penalties', to='contracts.contractsla'),
        ),
        migrations.AddIndex(
            model_name='clauselibrary',
            index=models.Index(fields=['clause_category', 'is_active'], name='contracts_c_clause__006cf4_idx'),
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['status', 'expiry_date'], name='contracts_c_status_8227fd_idx'),
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['contract_type', 'status'], name='contracts_c_contrac_fd43fa_idx'),
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['expiry_date', 'status'], name='contracts_c_expiry__6e6b5f_idx'),
        ),
        migrations.AddIndex(
            model_name='contract',
            index=models.Index(fields=['party_content_type', 'party_object_id'], name='contracts_c_party_c_e040be_idx'),
        ),
    ]
