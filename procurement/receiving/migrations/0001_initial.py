# Generated by Django 5.2.7 on 2025-11-08 13:25

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('ap', '0002_initial'),
        ('catalog', '0001_initial'),
        ('contenttypes', '0002_remove_content_type_name'),
        ('core', '0001_initial'),
        ('purchase_orders', '0002_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='StorageLocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(db_index=True, max_length=50)),
                ('name', models.CharField(max_length=200)),
                ('aisle', models.CharField(blank=True, max_length=20)),
                ('rack', models.CharField(blank=True, max_length=20)),
                ('shelf', models.CharField(blank=True, max_length=20)),
                ('bin', models.CharField(blank=True, max_length=20)),
                ('max_weight', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum weight capacity in kg', max_digits=10, null=True)),
                ('max_volume', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum volume capacity in cubic meters', max_digits=10, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_quarantine', models.BooleanField(default=False, help_text='Reserved for quarantined/inspection items')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Storage Location',
                'verbose_name_plural': 'Storage Locations',
                'ordering': ['warehouse', 'code'],
            },
        ),
        migrations.CreateModel(
            name='GoodsReceipt',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('grn_number', models.CharField(db_index=True, editable=False, max_length=20, unique=True)),
                ('source_document_id', models.PositiveIntegerField(blank=True, null=True)),
                ('po_reference', models.CharField(blank=True, help_text='PO number reference', max_length=50)),
                ('receipt_date', models.DateField(default=django.utils.timezone.now)),
                ('expected_date', models.DateField(blank=True, null=True)),
                ('delivery_note_number', models.CharField(blank=True, help_text="Supplier's delivery note/packing slip number", max_length=100)),
                ('vehicle_number', models.CharField(blank=True, max_length=50)),
                ('driver_name', models.CharField(blank=True, max_length=200)),
                ('grn_type', models.CharField(choices=[('CATEGORIZED_GOODS', 'Categorized Goods'), ('UNCATEGORIZED_GOODS', 'Uncategorized Goods'), ('SERVICES', 'Services')], default='UNCATEGORIZED_GOODS', help_text='Type of GRN: Categorized (catalog→inventory), Uncategorized (→expenses), Services (→expenses)', max_length=30)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('IN_PROGRESS', 'In Progress'), ('COMPLETED', 'Completed'), ('QUALITY_HOLD', 'Quality Hold'), ('REJECTED', 'Rejected'), ('CANCELLED', 'Cancelled')], db_index=True, default='DRAFT', max_length=20)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('requires_inspection', models.BooleanField(default=False)),
                ('inspection_status', models.CharField(blank=True, choices=[('PENDING', 'Pending'), ('IN_PROGRESS', 'In Progress'), ('PASSED', 'Passed'), ('FAILED', 'Failed'), ('WAIVED', 'Waived')], default='PENDING', max_length=20)),
                ('remarks', models.TextField(blank=True)),
                ('internal_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_goods_receipts', to=settings.AUTH_USER_MODEL)),
                ('po_header', models.ForeignKey(blank=True, help_text='Purchase Order reference', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='goods_receipts', to='purchase_orders.poheader')),
                ('received_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='received_goods_receipts', to=settings.AUTH_USER_MODEL)),
                ('source_document_type', models.ForeignKey(blank=True, help_text='Source document type (e.g., PO, Transfer Order)', null=True, on_delete=django.db.models.deletion.PROTECT, to='contenttypes.contenttype')),
                ('supplier', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='goods_receipts', to='ap.supplier')),
            ],
            options={
                'verbose_name': 'Goods Receipt',
                'verbose_name_plural': 'Goods Receipts',
                'ordering': ['-receipt_date', '-grn_number'],
            },
        ),
        migrations.CreateModel(
            name='GRNLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('line_number', models.PositiveIntegerField()),
                ('item_description', models.CharField(max_length=500)),
                ('item_type', models.CharField(choices=[('CATEGORIZED', 'Categorized - Linked to Catalog'), ('NON_CATEGORIZED', 'Non-Categorized - Free Text')], default='NON_CATEGORIZED', help_text='Whether item is linked to catalog or is free text (copied from PO)', max_length=20)),
                ('po_line_reference', models.CharField(blank=True, help_text='Reference to PO line', max_length=50)),
                ('ordered_quantity', models.DecimalField(decimal_places=4, help_text='Quantity ordered on PO', max_digits=15)),
                ('received_quantity', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), help_text='Quantity actually received', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.0000'))])),
                ('accepted_quantity', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), help_text='Quantity accepted after inspection', max_digits=15)),
                ('rejected_quantity', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), help_text='Quantity rejected', max_digits=15)),
                ('unit_price', models.DecimalField(blank=True, decimal_places=4, help_text='Unit price from PO (for invoice matching)', max_digits=15, null=True)),
                ('over_tolerance_pct', models.DecimalField(decimal_places=2, default=Decimal('10.00'), help_text='Allowed over-receipt percentage', max_digits=5)),
                ('under_tolerance_pct', models.DecimalField(decimal_places=2, default=Decimal('5.00'), help_text='Allowed under-receipt percentage', max_digits=5)),
                ('tolerance_exceeded', models.BooleanField(default=False)),
                ('tolerance_message', models.TextField(blank=True)),
                ('receipt_status', models.CharField(choices=[('PENDING', 'Pending'), ('PARTIAL', 'Partially Received'), ('FULL', 'Fully Received'), ('OVER', 'Over Received'), ('UNDER', 'Under Received')], default='PENDING', max_length=20)),
                ('lot_number', models.CharField(blank=True, help_text='Lot/Batch number from supplier', max_length=100)),
                ('serial_numbers', models.JSONField(blank=True, default=list, help_text='Serial numbers for serialized items')),
                ('manufacturing_date', models.DateField(blank=True, null=True)),
                ('expiry_date', models.DateField(blank=True, null=True)),
                ('put_away_completed', models.BooleanField(default=False)),
                ('put_away_at', models.DateTimeField(blank=True, null=True)),
                ('requires_inspection', models.BooleanField(default=False)),
                ('inspection_completed', models.BooleanField(default=False)),
                ('condition', models.CharField(choices=[('GOOD', 'Good Condition'), ('DAMAGED', 'Damaged'), ('EXPIRED', 'Expired'), ('DEFECTIVE', 'Defective'), ('INCOMPLETE', 'Incomplete')], default='GOOD', max_length=20)),
                ('remarks', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('catalog_item', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='grn_lines', to='catalog.catalogitem')),
                ('goods_receipt', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='receiving.goodsreceipt')),
                ('put_away_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='put_away_grn_lines', to=settings.AUTH_USER_MODEL)),
                ('unit_of_measure', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='grn_lines', to='catalog.unitofmeasure')),
                ('storage_location', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='grn_lines', to='receiving.storagelocation')),
            ],
            options={
                'verbose_name': 'GRN Line',
                'verbose_name_plural': 'GRN Lines',
                'ordering': ['goods_receipt', 'line_number'],
            },
        ),
        migrations.CreateModel(
            name='QualityInspection',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('inspection_number', models.CharField(db_index=True, editable=False, max_length=20, unique=True)),
                ('inspection_date', models.DateField(default=django.utils.timezone.now)),
                ('inspection_type', models.CharField(choices=[('RECEIVING', 'Receiving Inspection'), ('IN_PROCESS', 'In-Process Inspection'), ('FINAL', 'Final Inspection'), ('RANDOM', 'Random Sampling')], default='RECEIVING', max_length=50)),
                ('sample_size', models.PositiveIntegerField(default=0, help_text='Number of items inspected')),
                ('lot_size', models.PositiveIntegerField(default=0, help_text='Total lot size')),
                ('inspection_criteria', models.JSONField(blank=True, default=dict, help_text='Inspection checklist and criteria')),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('IN_PROGRESS', 'In Progress'), ('PASSED', 'Passed'), ('FAILED', 'Failed'), ('CONDITIONAL', 'Conditional Pass')], db_index=True, default='PENDING', max_length=20)),
                ('passed_quantity', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=15)),
                ('failed_quantity', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=15)),
                ('defects_found', models.JSONField(blank=True, default=list, help_text='List of defects found')),
                ('inspection_results', models.TextField(blank=True)),
                ('inspector_notes', models.TextField(blank=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('disposition', models.CharField(blank=True, choices=[('ACCEPT', 'Accept'), ('REJECT', 'Reject'), ('REWORK', 'Rework'), ('SORT', 'Sort/Screen'), ('RTV', 'Return to Vendor'), ('SCRAP', 'Scrap')], max_length=20)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_inspections', to=settings.AUTH_USER_MODEL)),
                ('goods_receipt', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='inspections', to='receiving.goodsreceipt')),
                ('grn_line', models.ForeignKey(blank=True, help_text='Specific line being inspected', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='inspections', to='receiving.grnline')),
                ('inspector', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='quality_inspections', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Quality Inspection',
                'verbose_name_plural': 'Quality Inspections',
                'ordering': ['-inspection_date', '-inspection_number'],
            },
        ),
        migrations.CreateModel(
            name='NonConformance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ncr_number', models.CharField(db_index=True, editable=False, max_length=20, unique=True)),
                ('ncr_date', models.DateField(default=django.utils.timezone.now)),
                ('severity', models.CharField(choices=[('MINOR', 'Minor'), ('MAJOR', 'Major'), ('CRITICAL', 'Critical')], default='MINOR', max_length=20)),
                ('issue_category', models.CharField(choices=[('QUANTITY', 'Quantity Variance'), ('QUALITY', 'Quality Issue'), ('DAMAGE', 'Damaged Goods'), ('PACKAGING', 'Packaging Issue'), ('DOCUMENTATION', 'Documentation Error'), ('SPECIFICATION', 'Specification Mismatch'), ('OTHER', 'Other')], default='QUALITY', max_length=100)),
                ('issue_description', models.TextField()),
                ('affected_quantity', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=15)),
                ('root_cause', models.TextField(blank=True)),
                ('corrective_action', models.TextField(blank=True)),
                ('preventive_action', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('OPEN', 'Open'), ('INVESTIGATION', 'Under Investigation'), ('ACTION_PENDING', 'Action Pending'), ('RESOLVED', 'Resolved'), ('CLOSED', 'Closed')], db_index=True, default='OPEN', max_length=20)),
                ('supplier_notified', models.BooleanField(default=False)),
                ('supplier_notified_at', models.DateTimeField(blank=True, null=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('resolution_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('goods_receipt', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='non_conformances', to='receiving.goodsreceipt')),
                ('grn_line', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='non_conformances', to='receiving.grnline')),
                ('reported_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='reported_ncrs', to=settings.AUTH_USER_MODEL)),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='resolved_ncrs', to=settings.AUTH_USER_MODEL)),
                ('quality_inspection', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='non_conformances', to='receiving.qualityinspection')),
            ],
            options={
                'verbose_name': 'Non-Conformance Report',
                'verbose_name_plural': 'Non-Conformance Reports',
                'ordering': ['-ncr_date', '-ncr_number'],
            },
        ),
        migrations.CreateModel(
            name='ReturnToVendor',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rtv_number', models.CharField(db_index=True, editable=False, max_length=20, unique=True)),
                ('rtv_date', models.DateField(default=django.utils.timezone.now)),
                ('return_reason', models.CharField(choices=[('DEFECTIVE', 'Defective'), ('WRONG_ITEM', 'Wrong Item'), ('EXCESS', 'Excess Quantity'), ('DAMAGED', 'Damaged in Transit'), ('EXPIRED', 'Expired'), ('NOT_ORDERED', 'Not Ordered'), ('OTHER', 'Other')], max_length=100)),
                ('return_reason_details', models.TextField()),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('SUBMITTED', 'Submitted to Supplier'), ('APPROVED', 'Supplier Approved'), ('SHIPPED', 'Shipped'), ('RECEIVED_BY_SUPPLIER', 'Received by Supplier'), ('CREDITED', 'Credit Issued'), ('CLOSED', 'Closed'), ('REJECTED', 'Rejected by Supplier')], db_index=True, default='DRAFT', max_length=30)),
                ('ship_date', models.DateField(blank=True, null=True)),
                ('carrier', models.CharField(blank=True, max_length=200)),
                ('tracking_number', models.CharField(blank=True, max_length=100)),
                ('total_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Total value being returned', max_digits=15)),
                ('debit_memo_number', models.CharField(blank=True, max_length=50)),
                ('debit_memo_date', models.DateField(blank=True, null=True)),
                ('credit_received', models.BooleanField(default=False)),
                ('credit_received_date', models.DateField(blank=True, null=True)),
                ('remarks', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_rtvs', to=settings.AUTH_USER_MODEL)),
                ('currency', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='returns', to='core.currency')),
                ('goods_receipt', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='returns', to='receiving.goodsreceipt')),
                ('non_conformance', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='returns', to='receiving.nonconformance')),
                ('supplier', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='returns', to='ap.supplier')),
            ],
            options={
                'verbose_name': 'Return to Vendor',
                'verbose_name_plural': 'Returns to Vendor',
                'ordering': ['-rtv_date', '-rtv_number'],
            },
        ),
        migrations.CreateModel(
            name='RTVLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('line_number', models.PositiveIntegerField()),
                ('return_quantity', models.DecimalField(decimal_places=4, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.0001'))])),
                ('unit_price', models.DecimalField(decimal_places=4, max_digits=15)),
                ('lot_number', models.CharField(blank=True, max_length=100)),
                ('serial_numbers', models.JSONField(blank=True, default=list)),
                ('remarks', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('catalog_item', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='rtv_lines', to='catalog.catalogitem')),
                ('grn_line', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='rtv_lines', to='receiving.grnline')),
                ('rtv', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='receiving.returntovendor')),
                ('unit_of_measure', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='rtv_lines', to='catalog.unitofmeasure')),
            ],
            options={
                'verbose_name': 'RTV Line',
                'verbose_name_plural': 'RTV Lines',
                'ordering': ['rtv', 'line_number'],
            },
        ),
        migrations.CreateModel(
            name='Warehouse',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(db_index=True, max_length=20, unique=True)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('address_line1', models.CharField(blank=True, max_length=200)),
                ('address_line2', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(blank=True, max_length=100)),
                ('state', models.CharField(blank=True, max_length=100)),
                ('postal_code', models.CharField(blank=True, max_length=20)),
                ('country', models.CharField(blank=True, max_length=100)),
                ('warehouse_type', models.CharField(choices=[('MAIN', 'Main Warehouse'), ('BRANCH', 'Branch Warehouse'), ('TRANSIT', 'Transit Location'), ('QUARANTINE', 'Quarantine Area'), ('SCRAP', 'Scrap/Rejected Area')], default='MAIN', max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('manager', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='managed_warehouses', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Warehouse',
                'verbose_name_plural': 'Warehouses',
                'ordering': ['code'],
            },
        ),
        migrations.AddField(
            model_name='storagelocation',
            name='warehouse',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='locations', to='receiving.warehouse'),
        ),
        migrations.AddField(
            model_name='goodsreceipt',
            name='warehouse',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='goods_receipts', to='receiving.warehouse'),
        ),
        migrations.AddIndex(
            model_name='qualityinspection',
            index=models.Index(fields=['status', 'inspection_date'], name='receiving_q_status_3c1032_idx'),
        ),
        migrations.AddIndex(
            model_name='qualityinspection',
            index=models.Index(fields=['goods_receipt', 'status'], name='receiving_q_goods_r_7a5336_idx'),
        ),
        migrations.AddIndex(
            model_name='nonconformance',
            index=models.Index(fields=['status', 'ncr_date'], name='receiving_n_status_f9f30c_idx'),
        ),
        migrations.AddIndex(
            model_name='nonconformance',
            index=models.Index(fields=['severity', 'status'], name='receiving_n_severit_688bfb_idx'),
        ),
        migrations.AddIndex(
            model_name='returntovendor',
            index=models.Index(fields=['status', 'rtv_date'], name='receiving_r_status_516422_idx'),
        ),
        migrations.AddIndex(
            model_name='returntovendor',
            index=models.Index(fields=['supplier', 'status'], name='receiving_r_supplie_83eced_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='rtvline',
            unique_together={('rtv', 'line_number')},
        ),
        migrations.AddIndex(
            model_name='grnline',
            index=models.Index(fields=['catalog_item'], name='receiving_g_catalog_4f4b53_idx'),
        ),
        migrations.AddIndex(
            model_name='grnline',
            index=models.Index(fields=['lot_number'], name='receiving_g_lot_num_2256a0_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='grnline',
            unique_together={('goods_receipt', 'line_number')},
        ),
        migrations.AlterUniqueTogether(
            name='storagelocation',
            unique_together={('warehouse', 'code')},
        ),
        migrations.AddIndex(
            model_name='goodsreceipt',
            index=models.Index(fields=['status', 'receipt_date'], name='receiving_g_status_fba0dc_idx'),
        ),
        migrations.AddIndex(
            model_name='goodsreceipt',
            index=models.Index(fields=['supplier', 'receipt_date'], name='receiving_g_supplie_5d9758_idx'),
        ),
        migrations.AddIndex(
            model_name='goodsreceipt',
            index=models.Index(fields=['warehouse', 'receipt_date'], name='receiving_g_warehou_c51ff2_idx'),
        ),
    ]
